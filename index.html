<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Phil Carr Quiz</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<div id="overlay">
  <button id="letsPlayBtn">Let's Play!</button>
</div>

<audio id="welcomeSound" src="sound3.wav" preload="auto"></audio>

<div class="container">
  <img src="images/phil1.jpg" alt="Phil Carr Logo" class="logo" />
  <h1>Welcome to Phil Carr!</h1>

  <div class="rules">
    <strong>How to Play:</strong><br />
    Five Rounds. Five questions per round<br />
    Bottom after each round spins the Wheel<br />
    Each team has 1x Phil Carr<br /><br />
    Good luck!
  </div>

<input type="text" id="playerName" placeholder="Enter Your Name" />
<button id="continueBtn">Continue</button>

<!-- Status message for waiting -->
<div id="status" style="margin-top: 10px; font-weight: bold; color: #444;"></div>

</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  // Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyAZxLjMZTYTOLBunk56HqyHkLyPJsQUtjA",
    authDomain: "philcarr-20ac0.firebaseapp.com",
    projectId: "philcarr-20ac0",
    storageBucket: "philcarr-20ac0.firebasestorage.app",
    messagingSenderId: "770728636073",
    appId: "1:770728636073:web:d2bddbee786446c37d03b8",
    measurementId: "G-XRCH682RNE"
  };

// Initialize Firebase & Firestore
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const gameDocRef = doc(db, 'games', 'defaultGame'); // Consistent game state doc

document.getElementById('continueBtn').addEventListener('click', async function () {
  const playerName = document.getElementById('playerName').value.trim();

  if (playerName === '') {
    alert('Please enter your name!');
    return;
  }

  try {
    // Save player to Firestore with initial score 0 and round 1
    await setDoc(doc(db, "players", playerName), {
      name: playerName,
      score: 0,
      currentRound: 1,
      timestamp: new Date()
    });

    console.log(`Player ${playerName} saved to Firestore.`);

    localStorage.setItem('playerName', playerName);

    // Show waiting message while listening for host to start the game
    const statusDiv = document.getElementById('status');
    statusDiv.textContent = "Waiting for host to start the game...";

onSnapshot(gameDocRef, (docSnap) => {
  if (!docSnap.exists()) {
    console.log("gameState/currentGame doc does not exist");
    return;
  }

  const data = docSnap.data();
  console.log("Homepage detected game state change:", data);

  const phase = data.phase || '';
  const gameId = data.gameId || 'defaultGame';

  // Priority redirect for winners
  if (phase === 'winners') {
    console.log("Redirecting to winners.html");
    window.location.href = `winners.html?gameId=${gameId}`;
    return; // stop further redirects
  }

  if (phase.startsWith('round')) {
    const roundNum = parseInt(phase.replace('round', ''), 10);
    console.log(`Redirecting to round.html for round ${roundNum}`);
    window.location.href = `round.html?round=${roundNum}&gameId=${gameId}`;
  } else if (phase === 'wheel') {
  console.log("Redirecting to winwheel.html");
  window.location.href = `winwheel.html?gameId=${gameId}`;
}
 else {
    console.log("No redirect â€” current phase:", phase);
  }
});





  } catch (error) {
    alert("Error saving player: " + error.message);
    console.error(error);
  }
});



    letsPlayBtn.addEventListener('click', () => {
      // Play sound
      welcomeSound.currentTime = 0;
      welcomeSound.play();

      // Fade out overlay
      overlay.style.transition = 'opacity 0.5s ease';
      overlay.style.opacity = '0';

      // After fade, remove overlay from DOM
      setTimeout(() => {
        overlay.style.display = 'none';
      }, 500);
    });
  
</script>


</body>
</html>

