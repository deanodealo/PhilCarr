<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Spin the Wheel</title>

  <!-- âœ… Use TweenMax (GSAP v2) not GSAP v3 -->
<!-- Load GSAP first -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<!-- Load Winwheel 2.7.0 (UMD build) -->
<script src="https://cdn.jsdelivr.net/gh/zarocknz/javascript-winwheel@2.7.0/Winwheel.min.js"></script>


  <style>
    body {
      background: #111;
      color: white;
      font-family: Verdana, sans-serif;
      text-align: center;
      padding: 20px;
    }

    h1 {
      font-size: 3rem;
      margin-bottom: 20px;
      color: #fff;
      text-shadow: 2px 2px #333;
    }

 #wheelContainer {
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  max-width: 100vw;
  overflow-x: hidden;
}
canvas {
  width: 90vw;
  max-width: 400px;
  height: auto;
}


    #spinBtn {
      margin-top: 40px;
      padding: 15px 30px;
      font-size: 1.5rem;
      border: none;
      background: linear-gradient(#ff8c00, #ff6600);
      color: white;
      border-radius: 20px;
      box-shadow: 0 6px #b34700;
      cursor: pointer;
      transition: 0.2s ease-in-out;
    }

    #spinBtn:hover {
      transform: scale(1.05);
    }

    #spinBtn:active {
      box-shadow: 0 2px #b34700;
      transform: translateY(4px);
    }

    #forfeitResult {
      margin-top: 40px;
      font-size: 2rem;
      font-weight: bold;
      color: #00ffcc;
    }
  </style>
</head>
<body>

  <h1>Spin the Wheel</h1>
  <canvas id="wheelCanvas" width="400" height="400"></canvas>
  <br />
  <button id="spinBtn">Spin the Wheel</button>

  <div id="forfeitResult"></div>

  <audio id="spinSound" src="sound1.wav" preload="auto"></audio>
  <audio id="winSound" src="sound2.wav" preload="auto"></audio>

  <button id="nextRoundBtn" style="display:none; margin-top: 30px; padding: 15px 30px; font-size: 1.5rem; cursor: pointer; border-radius: 12px; background: #00bcd4; color: #121212; border: none;">
  Next Round
</button>

<script>
  const spinSound = document.getElementById('spinSound');
  const winSound = document.getElementById('winSound');

  // Create an AudioContext to unlock mobile audio playback
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

  let currentRound = parseInt(localStorage.getItem('currentRound')) || 1;

  const theWheel = new Winwheel({
    canvasId: 'wheelCanvas',
    numSegments: 6,
    outerRadius: 180,
    textFontSize: 16,
    segments: [
      { fillStyle: '#e74c3c', text: 'Dance on table' },
      { fillStyle: '#2ecc71', text: 'Wear a dress' },
      { fillStyle: '#3498db', text: 'Sing karaoke' },
      { fillStyle: '#f1c40f', text: 'Shot of tequila' },
      { fillStyle: '#9b59b6', text: 'Selfie with a random' },
      { fillStyle: '#1abc9c', text: 'Jump in pool' },
    ],
    animation: {
      type: 'spinToStop',
      duration: 5,
      spins: 8,
      callbackFinished: function (indicatedSegment) {
        const forfeitDiv = document.getElementById('forfeitResult');
        forfeitDiv.textContent = 'Forfeit: ' + indicatedSegment.text;
        document.getElementById('nextRoundBtn').style.display = 'inline-block';

        // Play win sound audibly after spin finishes
        winSound.currentTime = 0;
        winSound.play();

        // Scroll smoothly to the forfeit result so user sees it
        forfeitDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    }
  });

  document.getElementById('spinBtn').addEventListener('click', () => {
    // Resume AudioContext on user interaction to unlock sound on mobile
    if (audioCtx.state === 'suspended') {
      audioCtx.resume();
    }

    // Play spin sound immediately
    spinSound.currentTime = 0;
    spinSound.play();

    // Play winSound muted and paused immediately to unlock playback on mobile
    winSound.muted = true;
    winSound.currentTime = 0;
    const playPromise = winSound.play();
    if (playPromise !== undefined) {
      playPromise.then(() => {
        winSound.pause();
        winSound.muted = false;
      }).catch(() => {
        // Ignore errors here
        winSound.muted = false;
      });
    }

    theWheel.stopAnimation(false);
    theWheel.rotationAngle = 0;
    theWheel.startAnimation();
    document.getElementById('forfeitResult').textContent = '';
  });

  document.getElementById('nextRoundBtn').addEventListener('click', () => {
    currentRound++;
    localStorage.setItem('currentRound', currentRound.toString());

    // Redirect to next round page, e.g. round2.html, round3.html...
    const nextRoundPage = `round${currentRound}.html`;

    // Optional: If round 6 or above, go to leaderboard or final page
    if (currentRound > 5) {
      window.location.href = 'leaderboard.html';
    } else {
      window.location.href = nextRoundPage;
    }
  });
</script>


</body>
</html>
